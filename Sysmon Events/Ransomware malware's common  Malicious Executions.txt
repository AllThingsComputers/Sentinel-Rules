// Title of Detection: Ransomware malware's common  Malicious Executions
// Authorship & Contact: https://allthingscomputers.medium.com  https://twitter.com/allthingshandle  https://allthingscomputersblog.wordpress.com/ 
 // Description of the Detection:This is performed by ransomware such as Ako, Avaddon, Conti, Lockbit, Ragnar, Ryuk, Netwalker, Nemty, ProLock, Lockbit, Ryuk, Maze, Darkside, Nemty, RansomExx, Sodinokibi, Ragnar, Conti and Snatch.   
// References (if available):  https://www.cyborgsecurity.com/cyborg-labs/hunting-ransomware-inhibiting-system-backup-or-recovery/
// The Logic of the Detection or Query Begins Below This Line
SysmonEvent
| where EventID == 1
| where CommandLine matches regex '(?i)(vssadmin\.exe Delete Shadows \/All \/Quiet|\/c vssadmin resize shadowstorage \/for=C: \/on=C: \/maxsize=401MB|\/c vssadmin resize shadowstorage \/for=C: \/on=C: \/maxsize=unbounded|wmic\.exe SHADOWCOPY \/nointeractive|wmic shadowcopy delete|wmic\.exe shadowcopy delete|Get-WmiObject Win32_Shadowcopy \| ForEach-Object {\$_\.Delete\(\);}|bcdedit \/set \{default\} bootstatuspolicy ignoreallfailures|bcdedit \/set \{default\} recoveryenabled no|bcdedit\.exe \/set \{current\} safeboot minimal|wbadmin DELETE SYSTEMSTATEBACKUP|wbadmin DELETE SYSTEMSTATEBACKUP - deleteOldest|wbadmin delete catalog -quiet|net stop BackupExecAgentAccelerator \/y‚ùònet stop BackupExecVSSProvider \/y)'
