// Title of Detection:  Registry Key Created
// Authorship & Contact: https://allthingscomputers.medium.com  https://twitter.com/allthingshandle  https://allthingscomputersblog.wordpress.com/ 
 // Description of the Detection:   Initial construction of a new Registry Key (ex: Windows EventID 4656 or Sysmon EventID 12)
// References (if available):    https://attack.mitre.org/datasources/DS0024/   https://attack.mitre.org/techniques/T1547/  https://attack.mitre.org/techniques/T1547/001/   https://attack.mitre.org/techniques/T1547/014/    https://attack.mitre.org/techniques/T1037/001/   https://attack.mitre.org/techniques/T1562/009/   https://attack.mitre.org/techniques/T1137/002/   https://attack.mitre.org/techniques/T1553/   https://attack.mitre.org/techniques/T1112/ 
// The Logic of the Detection or Query Begins Below This Line
SysmonEvent
| where EventID == 12 and TargetObject matches regex @'(?i)HKLM\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\|HKCU|\\Environment\\UserInitMprLogonScript|HKLM\\SYSTEM\\CurrentControlSet\Control|HKLM\SYSTEM\\CurrentControlSet\Control\\SafeBoot\\Minimal|HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\|HKLM\\SOFTWARE\\Microsoft\\EnterpriseCertificates\\Root\\Certificates\\|(HKLM|HKCU\\Software(\\Policies)?\\Microsoft\\SystemCertificates\\Root\\Certificates\\|HKLM\\SOFTWARE\\Microsoft\\EnterpriseCertificates\\Root\\Certificates\\|(HKLM|HKCU)\\Software(\\Policies)?\\Microsoft\\SystemCertificates\\Root\\Certificates\\|HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\load|HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\|HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\|HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\ \|HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\|HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx|HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders|HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders|HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell|HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce|HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders|HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce||HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServices|HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServices|HKLM\\Software\\Microsoft\\Windows\\Current Version\\Policies\\Explorer\\Run|HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run|HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit|HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit|HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows|HKLM\\System\\CurrentControlSet\Control\\Session Manager|HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost|HKCU\\Software\\Microsoft\\Windows\\Run|CurrentVersion\\Run|HKCU\\Software\\Run auto_update|HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell|HKCU\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\|HKLM\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\|HKCU\\Environment\\UserInitMprLogonScript|HKLM\\SYSTEM\\CurrentControlSet\\Services|HKLM\\SYSTEM\\CurrentControlSet\Control|HKLM\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\.*|HKLM\\SYSTEM\\CurrentControlSet\Control\\SafeBoot\\Minimal|| HKCU\\Software\\Microsoft\\Office Test\\Special\\Perf|HKLM\\Software\\Microsoft\\Office Test\\Special\\Perf|HKLM\\SOFTWARE\\Policies\\Microsoft\\SystemCertificates\\Root\\ProtectedRoots|HKLM\\SOFTWARE\\Microsoft\\EnterpriseCertificates\\Root\\Certificates\\|(HKLM|HKCU)\\Software(\\Policies)?\\Microsoft\\SystemCertificates\\Root\\Certificates|SYSTEM\\CurrentControlSet\Services\\SharedAccess\\Parameters\\Firewall Policy\\StandardProfileGloballyOpenPorts|HKCU\\Software\\Microsoft\\Office\\Excel\\Security\\AccessVBOM\\|HKLM\\SYSTEM\\CurrentControlSet\\Services|HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System|HKLM\\SYSTEM\\CurrentControlSet\Control\\Session Manager\\BootExecute|HKCU\\Software\\Microsoft\\Internet Explorer|SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LocalAccountTokenFilterPolicy|HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\sibot|HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap|HKCU\\Software\\Classes\\|HKLM\\SYSTEM\\CurrentControlSet\\services|HKCU\\Software\\Microsoft\\Internet Explorer\\PhishingFilter\\'